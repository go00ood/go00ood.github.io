---
layout: default
---

<article class="post h-entry">
  <header class="post-header">
    <h1 class="post-title p-name">{{ page.title }}</h1>
    {% if page.date %}
    <p class="post-meta">
      <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}">
        {{ page.date | date: "%Y-%m-%d" }}
      </time>
    </p>
    {% endif %}
  </header>

  <div id="encrypted_content">
  <form id="encrypt_form" method="post">
    <p>ğŸ”’ ì´ ê²Œì‹œë¬¼ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <input id="encrypt_password"
          type="password"
          name="password"
          placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
          autofocus />
    <input type="submit" value="Unlock"/>
    <p id="encrypt_error" style="color: red; display: none; margin-top: 0.5em;">
      ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
    </p>
  </form>
  </div>
</article>

<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.10/marked.min.js"></script>

<script>
  document.getElementById('encrypt_form').addEventListener('submit', function(e) {
    e.preventDefault();

    var passphrase = document.getElementById('encrypt_password').value;
    var encryptedMsg = '{{ page.encrypted | default: "" }}';

    console.log("ğŸ”‘ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸:", passphrase);
    console.log("ğŸ”’ ì•”í˜¸í™”ëœ ë©”ì‹œì§€:", encryptedMsg.slice(0, 80) + "...");

    if (!encryptedMsg) {
      document.getElementById('encrypted_content').innerHTML =
        "<p style='color:red;'>âš ï¸ ì•”í˜¸í™”ëœ ë³¸ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    var encryptedHMAC = encryptedMsg.substring(0, 64),
        encryptedHTML = encryptedMsg.substring(64),
        aesKey = CryptoJS.SHA256(passphrase).toString(),
        decryptedHMAC = CryptoJS.HmacSHA256(encryptedHTML, aesKey).toString();

    console.log("ğŸ”‘ ìƒì„±ëœ AES Key:", aesKey);
    console.log("ğŸ“ HMAC ë¹„êµ â†’", decryptedHMAC === encryptedHMAC);

    if (decryptedHMAC !== encryptedHMAC) {
      console.log("âŒ HMAC ë¶ˆì¼ì¹˜");
      document.getElementById('encrypt_error').style.display = 'block';
      return;
    }

    var plainText = CryptoJS.AES.decrypt(encryptedHTML, aesKey).toString(CryptoJS.enc.Utf8);

    console.log("ğŸ“œ ë³µí˜¸í™” ê²°ê³¼:", plainText ? plainText.slice(0, 100) : "(ë¹ˆ ë¬¸ìì—´)");

    if (!plainText) {
      document.getElementById('encrypt_error').style.display = 'block';
      return;
    }

    // ğŸ”§ Markdown ë³€í™˜ ì‹œë„
    try {
      var rendered = marked.parse(plainText);
      console.log("âœ… marked ë³€í™˜ ì„±ê³µ");
      document.getElementById('encrypted_content').innerHTML = rendered;
    } catch (err) {
      console.error("âŒ marked ë³€í™˜ ì‹¤íŒ¨:", err);
      // fallback: plain text ì¶œë ¥
      document.getElementById('encrypted_content').innerHTML = "<pre>" + plainText + "</pre>";
    }
  });
</script>
