---
layout: default
---

<article class="post h-entry">
  <header class="post-header">
    <h1 class="post-title p-name">{{ page.title }}</h1>
    {% if page.date %}
      <p class="post-meta">
        <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}">
          {{ page.date | date: "%Y-%m-%d" }}
        </time>
      </p>
    {% endif %}
  </header>

  <div id="encrypted_content">
    <form id="encrypt_form" action="javascript:void(0);">
      <p>ğŸ”’ ì´ ê²Œì‹œë¬¼ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
      <input
        id="encrypt_password"
        type="password"
        name="password"
        placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
        autofocus
        autocomplete="new-password"
      />
      <input type="submit" value="Unlock" />
      <p id="encrypt_error" style="color:red; display:none; margin-top:0.5em;">
        ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
      </p>
    </form>
  </div>
</article>

<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById('encrypt_form');
  if (!form) return;

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const passphrase = document.getElementById('encrypt_password').value;
    const encryptedMsg = {{ page.encrypted | jsonify }};

    if (!encryptedMsg) {
      document.getElementById('encrypted_content').innerHTML =
        "<p style='color:red;'>âš ï¸ ì•”í˜¸í™”ëœ ë³¸ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    const encryptedHMAC = encryptedMsg.substring(0, 64);
    const encryptedHTML = encryptedMsg.substring(64);
    const aesKey = CryptoJS.SHA256(passphrase).toString();
    const decryptedHMAC = CryptoJS.HmacSHA256(encryptedHTML, aesKey).toString();

    if (decryptedHMAC !== encryptedHMAC) {
      document.getElementById('encrypt_error').style.display = 'block';
      return;
    }

    const plainText = CryptoJS.AES.decrypt(encryptedHTML, aesKey).toString(CryptoJS.enc.Utf8);
    if (!plainText) {
      document.getElementById('encrypt_error').style.display = 'block';
      return;
    }

    try {
      const rendered = marked.parse(plainText);
      document.getElementById('encrypted_content').innerHTML = rendered;
    } catch (err) {
      document.getElementById('encrypted_content').innerHTML = "<pre>" + plainText + "</pre>";
    }
  });
});
</script>
